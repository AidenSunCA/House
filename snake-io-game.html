<!DOCTYPE html>
<html>
<head>
    <title>Snake.io Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #gameCanvas {
            border: 5px solid #333;
            background: #2d2d2d;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #4CAF50;
        }
        #leaderboard {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            min-width: 200px;
        }
        #leaderboard h3 {
            color: #FFD700;
            margin-bottom: 10px;
            text-align: center;
        }
        .leaderboard-entry {
            padding: 5px;
            margin: 3px 0;
            border-radius: 3px;
        }
        .leaderboard-entry.me {
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
        }
        #startScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border-radius: 15px;
            border: 3px solid #4CAF50;
            text-align: center;
            color: white;
            z-index: 100;
        }
        #startScreen h1 {
            color: #4CAF50;
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #4CAF50;
        }
        #startScreen input {
            padding: 10px;
            font-size: 18px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            margin: 20px 0;
            width: 250px;
            background: #2d2d2d;
            color: white;
        }
        #startScreen button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        #startScreen button:hover {
            background: #45a049;
            box-shadow: 0 0 20px #4CAF50;
        }
        #gameOverScreen {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            padding: 40px;
            border-radius: 15px;
            border: 3px solid #ff0000;
            text-align: center;
            color: white;
            z-index: 100;
        }
        #gameOverScreen h2 {
            color: #ff0000;
            font-size: 40px;
            margin-bottom: 20px;
        }
        #gameOverScreen button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <div id="ui">
        <div>Length: <span id="length">10</span></div>
        <div>Score: <span id="score">0</span></div>
        <div>Rank: <span id="rank">-</span></div>
    </div>

    <div id="leaderboard">
        <h3>üèÜ Leaderboard üèÜ</h3>
        <div id="leaderboardList"></div>
    </div>

    <div id="startScreen">
        <h1>üêç SNAKE.IO üêç</h1>
        <p style="font-size: 18px; margin: 20px 0;">Eat food to grow! Avoid other snakes!</p>
        <p>Compete against AI snakes for the top spot!</p>
        <input type="text" id="playerName" placeholder="Enter your name" maxlength="15" value="Player">
        <br>
        <button onclick="startGame()">PLAY NOW</button>
        <p style="margin-top: 20px; font-size: 14px;">Use WASD or Arrow Keys to move</p>
    </div>

    <div id="gameOverScreen">
        <h2>üíÄ GAME OVER üíÄ</h2>
        <p style="font-size: 24px; margin: 20px 0;">Final Length: <span id="finalLength">0</span></p>
        <p style="font-size: 20px;">Final Score: <span id="finalScore">0</span></p>
        <p style="font-size: 18px; margin-top: 10px;">Rank: <span id="finalRank">-</span></p>
        <button onclick="restartGame()">PLAY AGAIN</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth - 100;
        canvas.height = window.innerHeight - 100;

        // Game variables
        let gameActive = false;
        let playerName = 'Player';
        let cameraX = 0;
        let cameraY = 0;

        // World size
        const WORLD_WIDTH = 3000;
        const WORLD_HEIGHT = 3000;

        // Player snake
        let player = {
            segments: [],
            length: 10,
            speed: 4,
            angle: 0,
            color: '#4CAF50',
            name: 'Player',
            score: 0
        };

        // AI snakes
        let aiSnakes = [];
        const AI_COUNT = 10;

        // Food
        let food = [];
        const FOOD_COUNT = 200;

        // Movement keys
        let keys = {
            w: false,
            a: false,
            s: false,
            d: false,
            ArrowUp: false,
            ArrowLeft: false,
            ArrowDown: false,
            ArrowRight: false
        };
        let targetAngle = 0;

        const SNAKE_COLORS = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A',
            '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2',
            '#F8B739', '#52C4A6'
        ];

        const AI_NAMES = [
            'Bot_Alpha', 'Bot_Beta', 'Snake_Pro', 'Viper_King',
            'Cobra_Master', 'Python_Lord', 'Serpent_God', 'Anaconda_X',
            'Rattler_99', 'SlitherKing', 'NoodleBoi', 'LongBoi',
            'MegaSnake', 'FastSnake', 'HungrySnake'
        ];

        function initPlayer() {
            player.segments = [];
            const startX = WORLD_WIDTH / 2;
            const startY = WORLD_HEIGHT / 2;

            for (let i = 0; i < 10; i++) {
                player.segments.push({
                    x: startX - i * 10,
                    y: startY
                });
            }
            player.length = 10;
            player.score = 0;
            player.angle = 0;
            player.name = playerName;
        }

        function initAI() {
            aiSnakes = [];
            for (let i = 0; i < AI_COUNT; i++) {
                const snake = {
                    segments: [],
                    length: Math.floor(Math.random() * 20) + 10,
                    speed: 3 + Math.random() * 2,
                    angle: Math.random() * Math.PI * 2,
                    color: SNAKE_COLORS[i % SNAKE_COLORS.length],
                    name: AI_NAMES[i % AI_NAMES.length],
                    score: 0,
                    targetFood: null,
                    alive: true
                };

                const startX = Math.random() * WORLD_WIDTH;
                const startY = Math.random() * WORLD_HEIGHT;

                for (let j = 0; j < snake.length; j++) {
                    snake.segments.push({
                        x: startX - j * 10,
                        y: startY
                    });
                }

                aiSnakes.push(snake);
            }
        }

        function initFood() {
            food = [];
            for (let i = 0; i < FOOD_COUNT; i++) {
                food.push({
                    x: Math.random() * WORLD_WIDTH,
                    y: Math.random() * WORLD_HEIGHT,
                    size: 5 + Math.random() * 5,
                    color: `hsl(${Math.random() * 360}, 70%, 60%)`
                });
            }
        }

        function startGame() {
            playerName = document.getElementById('playerName').value || 'Player';
            document.getElementById('startScreen').style.display = 'none';
            gameActive = true;
            initPlayer();
            initAI();
            initFood();
            gameLoop();
        }

        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
        }

        function gameOver() {
            gameActive = false;
            document.getElementById('finalLength').textContent = player.length;
            document.getElementById('finalScore').textContent = player.score;
            document.getElementById('finalRank').textContent = document.getElementById('rank').textContent;
            document.getElementById('gameOverScreen').style.display = 'block';
        }

        function updateSnake(snake, targetX, targetY) {
            if (!snake.segments.length) return;

            const head = snake.segments[0];

            // Calculate angle to target
            const dx = targetX - head.x;
            const dy = targetY - head.y;
            const targetAngle = Math.atan2(dy, dx);

            // Smooth turning
            let angleDiff = targetAngle - snake.angle;
            while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
            while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
            snake.angle += angleDiff * 0.1;

            // Move head
            const newHead = {
                x: head.x + Math.cos(snake.angle) * snake.speed,
                y: head.y + Math.sin(snake.angle) * snake.speed
            };

            // Wrap around world
            if (newHead.x < 0) newHead.x = WORLD_WIDTH;
            if (newHead.x > WORLD_WIDTH) newHead.x = 0;
            if (newHead.y < 0) newHead.y = WORLD_HEIGHT;
            if (newHead.y > WORLD_HEIGHT) newHead.y = 0;

            snake.segments.unshift(newHead);

            // Keep length
            while (snake.segments.length > snake.length) {
                snake.segments.pop();
            }
        }

        function updateAI() {
            for (let snake of aiSnakes) {
                if (!snake.alive) continue;

                const head = snake.segments[0];

                // Find nearest food if no target or occasionally switch targets
                if (!snake.targetFood || Math.random() < 0.02) {
                    let nearestFood = null;
                    let nearestDist = Infinity;

                    for (let f of food) {
                        const dist = Math.hypot(f.x - head.x, f.y - head.y);
                        if (dist < nearestDist && dist < 500) { // Only look for food within range
                            nearestDist = dist;
                            nearestFood = f;
                        }
                    }
                    snake.targetFood = nearestFood;
                }

                // Move towards target food using 8-directional movement
                if (snake.targetFood) {
                    const dx = snake.targetFood.x - head.x;
                    const dy = snake.targetFood.y - head.y;

                    // Determine 8-directional angle (0, 45, 90, 135, 180, 225, 270, 315 degrees)
                    const rawAngle = Math.atan2(dy, dx);
                    const degrees = rawAngle * (180 / Math.PI);

                    // Snap to nearest 45-degree angle
                    const snappedDegrees = Math.round(degrees / 45) * 45;
                    const targetAngle = snappedDegrees * (Math.PI / 180);

                    // Smoothly interpolate to target angle
                    let angleDiff = targetAngle - snake.angle;
                    while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
                    while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;

                    // Faster turning for AI
                    snake.angle += angleDiff * 0.15;

                    // Move the snake
                    const newHead = {
                        x: head.x + Math.cos(snake.angle) * snake.speed,
                        y: head.y + Math.sin(snake.angle) * snake.speed
                    };

                    // Wrap around world
                    if (newHead.x < 0) newHead.x = WORLD_WIDTH;
                    if (newHead.x > WORLD_WIDTH) newHead.x = 0;
                    if (newHead.y < 0) newHead.y = WORLD_HEIGHT;
                    if (newHead.y > WORLD_HEIGHT) newHead.y = 0;

                    snake.segments.unshift(newHead);

                    // Keep length
                    while (snake.segments.length > snake.length) {
                        snake.segments.pop();
                    }

                    // Check food collision
                    for (let i = food.length - 1; i >= 0; i--) {
                        const f = food[i];
                        const dist = Math.hypot(f.x - newHead.x, f.y - newHead.y);
                        if (dist < 15) {
                            snake.length += 2;
                            snake.score += 10;
                            food.splice(i, 1);
                            // Spawn new food
                            food.push({
                                x: Math.random() * WORLD_WIDTH,
                                y: Math.random() * WORLD_HEIGHT,
                                size: 5 + Math.random() * 5,
                                color: `hsl(${Math.random() * 360}, 70%, 60%)`
                            });
                            snake.targetFood = null;
                            break;
                        }
                    }
                } else {
                    // Random wandering in 8 directions if no food target
                    if (Math.random() < 0.05) {
                        // Pick random 8-directional angle
                        const directions = [0, 45, 90, 135, 180, 225, 270, 315];
                        const randomDirection = directions[Math.floor(Math.random() * directions.length)];
                        snake.angle = randomDirection * (Math.PI / 180);
                    }

                    // Move
                    const newHead = {
                        x: head.x + Math.cos(snake.angle) * snake.speed,
                        y: head.y + Math.sin(snake.angle) * snake.speed
                    };

                    // Wrap around world
                    if (newHead.x < 0) newHead.x = WORLD_WIDTH;
                    if (newHead.x > WORLD_WIDTH) newHead.x = 0;
                    if (newHead.y < 0) newHead.y = WORLD_HEIGHT;
                    if (newHead.y > WORLD_HEIGHT) newHead.y = 0;

                    snake.segments.unshift(newHead);
                    while (snake.segments.length > snake.length) {
                        snake.segments.pop();
                    }
                }
            }
        }

        function checkCollisions() {
            const playerHead = player.segments[0];

            // Check player vs food
            for (let i = food.length - 1; i >= 0; i--) {
                const f = food[i];
                const dist = Math.hypot(f.x - playerHead.x, f.y - playerHead.y);
                if (dist < 15) {
                    player.length += 2;
                    player.score += 10;
                    food.splice(i, 1);
                    // Spawn new food
                    food.push({
                        x: Math.random() * WORLD_WIDTH,
                        y: Math.random() * WORLD_HEIGHT,
                        size: 5 + Math.random() * 5,
                        color: `hsl(${Math.random() * 360}, 70%, 60%)`
                    });
                }
            }

            // Check player vs AI snakes (hitting their body)
            for (let snake of aiSnakes) {
                if (!snake.alive) continue;
                for (let i = 0; i < snake.segments.length; i++) {
                    const segment = snake.segments[i];
                    const dist = Math.hypot(segment.x - playerHead.x, segment.y - playerHead.y);
                    // Head-to-head collision or hitting body
                    if (dist < 10) {
                        gameOver();
                        return;
                    }
                }
            }

            // Check player vs self
            for (let i = 10; i < player.segments.length; i++) {
                const segment = player.segments[i];
                const dist = Math.hypot(segment.x - playerHead.x, segment.y - playerHead.y);
                if (dist < 8) {
                    gameOver();
                    return;
                }
            }

            // Check AI snakes vs player body (AI dies if it hits player)
            for (let snake of aiSnakes) {
                if (!snake.alive || snake.segments.length === 0) continue;
                const aiHead = snake.segments[0];

                // Check if AI hits player body
                for (let i = 0; i < player.segments.length; i++) {
                    const segment = player.segments[i];
                    const dist = Math.hypot(segment.x - aiHead.x, segment.y - aiHead.y);
                    if (dist < 10) {
                        // AI snake dies
                        snake.alive = false;
                        // Player gets points for killing AI
                        player.score += 50;
                        player.length += 5;
                        break;
                    }
                }
            }

            // Check AI vs AI collisions (AI snakes can kill each other)
            for (let i = 0; i < aiSnakes.length; i++) {
                const snake1 = aiSnakes[i];
                if (!snake1.alive || snake1.segments.length === 0) continue;
                const head1 = snake1.segments[0];

                for (let j = 0; j < aiSnakes.length; j++) {
                    if (i === j) continue; // Don't check against self
                    const snake2 = aiSnakes[j];
                    if (!snake2.alive) continue;

                    // Check if snake1's head hits snake2's body
                    for (let k = 0; k < snake2.segments.length; k++) {
                        const segment = snake2.segments[k];
                        const dist = Math.hypot(segment.x - head1.x, segment.y - head1.y);
                        if (dist < 10) {
                            // snake1 dies
                            snake1.alive = false;
                            // snake2 gets rewarded
                            snake2.length += 3;
                            snake2.score += 30;
                            break;
                        }
                    }
                    if (!snake1.alive) break;
                }

                // Check AI vs own body
                if (snake1.alive) {
                    for (let k = 10; k < snake1.segments.length; k++) {
                        const segment = snake1.segments[k];
                        const dist = Math.hypot(segment.x - head1.x, segment.y - head1.y);
                        if (dist < 8) {
                            snake1.alive = false;
                            break;
                        }
                    }
                }
            }
        }

        function updateCamera() {
            const head = player.segments[0];
            cameraX = head.x - canvas.width / 2;
            cameraY = head.y - canvas.height / 2;
        }

        function drawWorld() {
            // Draw grid
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;

            const gridSize = 50;
            const startX = Math.floor(cameraX / gridSize) * gridSize;
            const startY = Math.floor(cameraY / gridSize) * gridSize;

            for (let x = startX; x < cameraX + canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x - cameraX, 0);
                ctx.lineTo(x - cameraX, canvas.height);
                ctx.stroke();
            }

            for (let y = startY; y < cameraY + canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y - cameraY);
                ctx.lineTo(canvas.width, y - cameraY);
                ctx.stroke();
            }

            // Draw world border
            ctx.strokeStyle = '#ff0000';
            ctx.lineWidth = 5;
            ctx.strokeRect(-cameraX, -cameraY, WORLD_WIDTH, WORLD_HEIGHT);
        }

        function drawFood() {
            for (let f of food) {
                const screenX = f.x - cameraX;
                const screenY = f.y - cameraY;

                if (screenX > -20 && screenX < canvas.width + 20 &&
                    screenY > -20 && screenY < canvas.height + 20) {
                    ctx.fillStyle = f.color;
                    ctx.beginPath();
                    ctx.arc(screenX, screenY, f.size, 0, Math.PI * 2);
                    ctx.fill();

                    // Glow effect
                    ctx.strokeStyle = f.color;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        }

        function drawSnake(snake) {
            // Draw segments
            for (let i = snake.segments.length - 1; i >= 0; i--) {
                const segment = snake.segments[i];
                const screenX = segment.x - cameraX;
                const screenY = segment.y - cameraY;

                if (screenX > -50 && screenX < canvas.width + 50 &&
                    screenY > -50 && screenY < canvas.height + 50) {

                    const size = i === 0 ? 12 : 10 - (i / snake.segments.length) * 3;

                    // Body
                    ctx.fillStyle = snake.color;
                    ctx.beginPath();
                    ctx.arc(screenX, screenY, size, 0, Math.PI * 2);
                    ctx.fill();

                    // Outline
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    ctx.stroke();

                    // Head features
                    if (i === 0) {
                        // Eyes
                        const eyeAngle = snake.angle;
                        const eyeX1 = screenX + Math.cos(eyeAngle + 0.5) * 6;
                        const eyeY1 = screenY + Math.sin(eyeAngle + 0.5) * 6;
                        const eyeX2 = screenX + Math.cos(eyeAngle - 0.5) * 6;
                        const eyeY2 = screenY + Math.sin(eyeAngle - 0.5) * 6;

                        ctx.fillStyle = 'white';
                        ctx.beginPath();
                        ctx.arc(eyeX1, eyeY1, 3, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.arc(eyeX2, eyeY2, 3, 0, Math.PI * 2);
                        ctx.fill();

                        ctx.fillStyle = 'black';
                        ctx.beginPath();
                        ctx.arc(eyeX1, eyeY1, 1.5, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.arc(eyeX2, eyeY2, 1.5, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }

            // Draw name above head
            if (snake.segments.length > 0) {
                const head = snake.segments[0];
                const screenX = head.x - cameraX;
                const screenY = head.y - cameraY;

                if (screenX > -50 && screenX < canvas.width + 50 &&
                    screenY > -50 && screenY < canvas.height + 50) {
                    ctx.fillStyle = 'white';
                    ctx.strokeStyle = 'black';
                    ctx.lineWidth = 3;
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.strokeText(snake.name, screenX, screenY - 20);
                    ctx.fillText(snake.name, screenX, screenY - 20);
                }
            }
        }

        function updateLeaderboard() {
            const allSnakes = [player, ...aiSnakes.filter(s => s.alive)];
            allSnakes.sort((a, b) => b.length - a.length);

            const listHtml = allSnakes.slice(0, 10).map((snake, index) => {
                const isPlayer = snake === player;
                const className = isPlayer ? 'leaderboard-entry me' : 'leaderboard-entry';
                return `<div class="${className}">${index + 1}. ${snake.name} - ${snake.length}</div>`;
            }).join('');

            document.getElementById('leaderboardList').innerHTML = listHtml;

            // Update rank
            const rank = allSnakes.indexOf(player) + 1;
            document.getElementById('rank').textContent = `#${rank}`;
        }

        function updateUI() {
            document.getElementById('length').textContent = player.length;
            document.getElementById('score').textContent = player.score;
        }

        function updatePlayerDirection() {
            // Calculate target angle based on keys pressed
            let dx = 0;
            let dy = 0;

            if (keys.w || keys.ArrowUp) dy = -1;
            if (keys.s || keys.ArrowDown) dy = 1;
            if (keys.a || keys.ArrowLeft) dx = -1;
            if (keys.d || keys.ArrowRight) dx = 1;

            // Only update target angle if a key is pressed
            if (dx !== 0 || dy !== 0) {
                targetAngle = Math.atan2(dy, dx);
            }
        }

        function gameLoop() {
            if (!gameActive) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update player direction from keys
            updatePlayerDirection();

            // Calculate target position based on current angle
            const head = player.segments[0];
            const targetX = head.x + Math.cos(targetAngle) * 100;
            const targetY = head.y + Math.sin(targetAngle) * 100;

            // Update player
            updateSnake(player, targetX, targetY);

            // Update AI
            updateAI();

            // Update camera
            updateCamera();

            // Draw
            drawWorld();
            drawFood();

            // Draw AI snakes
            for (let snake of aiSnakes) {
                if (snake.alive) {
                    drawSnake(snake);
                }
            }

            // Draw player
            drawSnake(player);

            // Check collisions
            checkCollisions();

            // Update UI
            updateUI();
            updateLeaderboard();

            requestAnimationFrame(gameLoop);
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();
            if (key in keys || e.key in keys) {
                e.preventDefault();
                if (key in keys) {
                    keys[key] = true;
                } else {
                    keys[e.key] = true;
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            const key = e.key.toLowerCase();
            if (key in keys || e.key in keys) {
                if (key in keys) {
                    keys[key] = false;
                } else {
                    keys[e.key] = false;
                }
            }
        });

        // Window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth - 100;
            canvas.height = window.innerHeight - 100;
        });
    </script>
</body>
</html>
